import matplotlib.pyplot as plt
import numpy as np

from qpara import correct_win_dict, main, plot_fluctuations

if __name__ == "__main__":
    trange = ["2015-10-16/09:24:11", "2015-10-16/09:25:24"]
    win_dict = {"ms": ["2015-10-16 09:24:11.3191", "2015-10-16 09:25:24.7941"]}
    win_dict = correct_win_dict(win_dict)
    data_dict = main(trange, win_dict)  # type: ignore
    fig, axs = plot_fluctuations(data_dict=data_dict)
    data = np.array(
        [
            [1.4543998581800373, 0.0026416483203860978],
            [2.7677282098848375, 0.0047542644301110625],
            [6.827792324102809, 0.01024275221381593],
            [12.059463454124948, 0.016155980984398754],
            [16.631156867048468, 0.02053525026457148],
            [24.097001932096894, 0.02673519359933993],
            [33.22994592714548, 0.03357698268059217],
            [53.13817563527232, 0.0447756260319464],
            [102.24375930366504, 0.06339913511724847],
            [165.4498751792918, 0.07773650302387762],
            [239.55245384091285, 0.08869857990181923],
            [330.13283811511076, 0.09880789942928697],
            [472.05408018177724, 0.10875727897549065],
            [666.5119375819471, 0.11274137659327856],
            [726.6023388007027, 0.11547819846894584],
            [907.2366541049897, 0.12409377607517198],
            [989.0299596282338, 0.12710617996147452],
        ]
    )
    markers = np.array(
        [
            [15.78614, 0.00983],
            [15.32304, 0.01718],
            [14.15344, 0.01803],
            [14.15344, 0.02103],
            [14.87352, 0.02103],
            [12.07526, 0.02359],
        ]
    )
    axs[1].plot(data[:, 0], data[:, 1], ls="--", color="k")
    axs[1].scatter(markers[:, 0], markers[:, 1], marker=".", color="k")  # type: ignore

    og_chen = np.array(
        [
            [1.000, 0.002],
            [1.000, 0.002],
            [1.000, 0.002],
            [1.000, 0.002],
            [1.000, 0.002],
            [1.000, 0.002],
            [1.000, 0.002],
            [1.000, 0.002],
            [2.000, 0.004],
            [2.000, 0.004],
            [2.000, 0.004],
            [2.000, 0.004],
            [3.000, 0.006],
            [3.000, 0.006],
            [3.000, 0.006],
            [4.000, 0.008],
            [4.000, 0.008],
            [4.000, 0.008],
            [5.000, 0.010],
            [6.000, 0.011],
            [6.000, 0.011],
            [7.000, 0.013],
            [7.000, 0.013],
            [8.000, 0.014],
            [9.000, 0.015],
            [10.000, 0.017],
            [11.000, 0.018],
            [12.000, 0.019],
            [14.000, 0.021],
            [15.000, 0.022],
            [17.000, 0.024],
            [18.000, 0.025],
            [20.000, 0.027],
            [22.000, 0.029],
            [24.000, 0.031],
            [27.000, 0.033],
            [29.000, 0.035],
            [32.000, 0.037],
            [36.000, 0.040],
            [39.000, 0.042],
            [43.000, 0.044],
            [48.000, 0.047],
            [52.000, 0.049],
            [58.000, 0.052],
            [63.000, 0.054],
            [70.000, 0.057],
            [77.000, 0.060],
            [84.000, 0.062],
            [93.000, 0.066],
            [102.000, 0.069],
            [112.000, 0.071],
            [123.000, 0.074],
            [135.000, 0.077],
            [149.000, 0.081],
            [164.000, 0.084],
            [180.000, 0.087],
            [198.000, 0.090],
            [217.000, 0.093],
            [239.000, 0.096],
            [263.000, 0.098],
            [289.000, 0.101],
            [318.000, 0.102],
            [349.000, 0.103],
            [384.000, 0.104],
            [422.000, 0.105],
            [464.000, 0.105],
            [510.000, 0.107],
            [560.000, 0.110],
            [616.000, 0.115],
            [677.000, 0.119],
            [744.000, 0.124],
            [818.000, 0.129],
            [899.000, 0.134],
            [988.000, 0.140],
            [1086.000, 0.148],
            [1193.000, 0.153],
            [1311.000, 0.161],
            [1441.000, 0.167],
            [1584.000, 0.177],
            [1741.000, 0.184],
            [1914.000, 0.192],
            [2103.000, 0.202],
            [2312.000, 0.210],
            [2541.000, 0.223],
            [2793.000, 0.232],
            [3069.000, 0.240],
            [3373.000, 0.247],
            [3708.000, 0.250],
            [4075.000, 0.258],
            [4479.000, 0.265],
            [4922.000, 0.277],
            [5410.000, 0.300],
            [5946.000, 0.328],
            [6535.000, 0.364],
            [7183.000, 0.418],
            [7895.000, 0.483],
            [8677.000, 0.525],
            [9536.000, 0.561],
            [10481.000, 0.598],
            [11519.000, 0.530],
        ]
    )
    axs[1].plot(og_chen[:, 0], og_chen[:, 1], ls=":", color="grey")

    og_seps = np.array(
        [
            [14.1647032405814, 0.014997918594316291],
            [12.127968646227213, 0.008378078982367324],
            [14.908867539514839, 0.01505751102659701],
            [14.166713481677277, 0.01897866868469851],
            [15.768671900767238, 0.023732058529713083],
            [15.383698738947881, 0.015295364898664841],
        ]
    )
    axs[1].scatter(
        og_seps[:, 0],
        og_seps[:, 1],
        marker="^",  # type: ignore
        edgecolors="grey",
        color="none",
    )

    from rich import print

    print(data_dict)
    # plt.savefig("cc.svg")
    plt.show()
